---
title: 'Get Started'
description: 'Start sharding your PostgreSQL cluster in 5 minutes'
---

import DockerImage from '/snippets/docker_image.mdx';
import BuildLocal from '/snippets/build_local.mdx';

Let's set up the simplest possible installation scenario - when you have two shards and one router.

<AccordionGroup>
  <Accordion icon="docker" title="Pull the SPQR docker image">
    <DockerImage />
  </Accordion>
  <Accordion icon="rectangle-terminal" title="Build the SPQR locally">
    <BuildLocal />
  </Accordion>
</AccordionGroup>


## Setting up sharding

First, you need to configure the rules by which the router will decide which of the shards to send each request to.

For this purpose, SPQR has an **administrative console**. This is an app that works by PostgreSQL protocol and you can connect to it by usual psql. You can find the console port in your config file.

<Note>
If you're using the Docker setup from this guide, the admin console is not exposed by default. You'll need to either:
1. Add `- "7432:7432"` to the router ports in docker-compose.yaml, or
2. Connect to the router container and use localhost:7432 from inside
</Note>

```sql
➜  psql "host=localhost sslmode=disable user=user1 dbname=db1 port=7432"
SPQR router admin console
Here you can set up your own routing rules
------------------------------------------------
You can find the documentation here
https://github.com/pg-sharding/spqr/tree/master/docs

psql (14.5 (Homebrew), server console)
Type "help" to get help.

db1=> SHOW shards;
  listing data shards  
-----------------------
 datashard with ID sh1
 datashard with ID sh2
 datashard with ID sh3
 datashard with ID sh4
(4 rows)
```

To make all things work, the router needs to know the following:

- What tables do you query
- Which columns in each table should the router search for
- Types of these columns
- Mapping from [range of values] to [shard number]

Let's create a distribution first:

```sql
➜ psql "host=localhost sslmode=disable user=user1 dbname=db1 port=7432"
db1=> CREATE DISTRIBUTION ds1 COLUMN TYPES integer;
         add distribution         
----------------------------------
 created distribution with id ds1
(1 row)
```

The next step is to specify a list of tables and columns.

```sql
db1=> ALTER DISTRIBUTION ds1 ATTACH RELATION orders DISTRIBUTION KEY id;
                 attach table               
--------------------------------------------
 attached relation orders to distribution ds1
(1 row)

db1=> ALTER DISTRIBUTION ds1 ATTACH RELATION items DISTRIBUTION KEY order_id;
                 attach table                 
----------------------------------------------
 attached relation items to distribution ds1
(1 row)
```

And at the end specify a list of ranges: which values to route to which shard. Note: The right bound is infinity if there are no key ranges.

```sql
CREATE KEY RANGE FROM 1 ROUTE TO sh1 FOR DISTRIBUTION ds1;
         add key range          
--------------------------------
 created key range with bound 1
(1 row)

CREATE KEY RANGE FROM 1000 ROUTE TO sh2 FOR DISTRIBUTION ds1;
            add key range          
-----------------------------------
 created key range with bound 1000
(1 row)
```

Here we go! You can play with some SELECTs or INSERTs.

## Connect to SPQR router

Now we can connect to proxy a.k.a. router and play with it. Please use psql again, but this time connect to a different port.

<Note>
If you're using the Docker setup from this guide, the router port 6432 is mapped to 8432 on your host machine. Use port 8432 to connect from your host.
</Note>

```bash
➜ psql "host=localhost sslmode=disable user=user1 dbname=db1 port=8432"
psql (13.3, server 9.6.22)
Type "help" for help.

db1=> CREATE TABLE orders (
    id SERIAL NOT NULL PRIMARY KEY,
    customer_id INT,
    order_date DATE
);
NOTICE: send query to shard(s) : sh1,sh2
CREATE TABLE

db1=> CREATE TABLE items (
    id SERIAL NOT NULL PRIMARY KEY,
    order_id SERIAL NOT NULL,
    name VARCHAR
);
NOTICE: send query to shard(s) : sh1,sh2
CREATE TABLE
```

Then, populate it with an order:

```bash
db1=> BEGIN;
BEGIN
db1=> INSERT INTO orders (id, customer_id, order_date) VALUES (777, 123456, '2024-01-08');
NOTICE: send query to shard(s) : sh1
INSERT 0 1
db1=> INSERT INTO items (id, order_id, name) VALUES (1, 777, 'elephant');
INSERT 0 1
db1=> COMMIT;
COMMIT
```

> NOTICE messages are disabled by default, specify `show_notice_messages` setting in the router config to enable them

The order can be found on the first shard:

```bash
db1=> SELECT * FROM orders WHERE id = 777;
NOTICE: send query to shard(s) : sh1
  id  | customer_id | order_date 
------+-------------+------------
  777 |   123456    | 2024-01-08
(1 row)
```

SPQR can handle such queries as `SELECT * FROM table` but we don't recommend using it. This feature is implemented in a non-transactional way.

```bash
db1=> SELECT * FROM orders;
NOTICE: send query to shard(s) : sh1,sh2
  id  | customer_id | order_date 
------+-------------+------------
  777 |   123456    | 2024-01-08
(1 row)
```
