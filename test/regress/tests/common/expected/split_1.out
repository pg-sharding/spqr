CREATE DISTRIBUTION ds1 COLUMN TYPES integer;
    add distribution    
------------------------
 distribution id -> ds1
(1 row)

CREATE KEY RANGE krid2 FROM 11 ROUTE TO sh2 FOR DISTRIBUTION ds1;
 add key range 
---------------
 bound -> 11
(1 row)

CREATE KEY RANGE krid1 FROM 0 ROUTE TO sh1 FOR DISTRIBUTION ds1;
 add key range 
---------------
 bound -> 0
(1 row)

ALTER DISTRIBUTION ds1 ATTACH RELATION test DISTRIBUTION KEY id;
      attach table       
-------------------------
 relation name   -> test
 distribution id -> ds1
(2 rows)

SPLIT KEY RANGE krid3 FROM krid1 BY 5;
    split key range    
-----------------------
 key range id -> krid3
 bound        ->      +
 
(2 rows)

SHOW key_ranges;
 key_range_id | shard_id | distribution_id | lower_bound | locked 
--------------+----------+-----------------+-------------+--------
 krid1        | sh1      | ds1             | 0           | false
 krid2        | sh2      | ds1             | 11          | false
 krid3        | sh1      | ds1             | 5           | false
(3 rows)

LOCK KEY RANGE krid1;
    lock key range     
-----------------------
 key range id -> krid1
(1 row)

SPLIT KEY RANGE krid4 FROM krid1 BY 5;
ERROR:  retryable: key range krid1 is locked
UNLOCK KEY RANGE krid1;
   unlock key range    
-----------------------
 key range id -> krid1
(1 row)

SPLIT KEY RANGE krid4 FROM krid1 BY 50;
ERROR:  failed to split because bound intersects with "krid2" key range
SPLIT KEY RANGE krid4 FROM krid2 BY 5;
ERROR:  failed to split because bound is out of key range
CREATE DISTRIBUTION ds2 COLUMN TYPES UUID;
    add distribution    
------------------------
 distribution id -> ds2
(1 row)

-- invalid value
CREATE KEY RANGE krid5 FROM '0000-0000' ROUTE TO sh1 FOR DISTRIBUTION ds2;
ERROR:  invalid UUID length: 9
-- correct create
CREATE KEY RANGE krid5 FROM '00000000-0000-0000-0000-000000000000' ROUTE TO sh1 FOR DISTRIBUTION ds2;
                  add key range                  
-------------------------------------------------
 bound -> '00000000-0000-0000-0000-000000000000'
(1 row)

-- correct split
SPLIT KEY RANGE krid6 FROM krid5 BY 'FF000000-0000-0000-0000-000000000000';
                   split key range                    
------------------------------------------------------
 key range id -> krid6
 bound        -> ff000000-0000-0000-0000-000000000000
(2 rows)

-- intersecting key range
SPLIT KEY RANGE krid7 FROM krid5 BY 'FF000000-0000-0000-0000-F00000000000';
ERROR:  failed to split because bound intersects with "krid6" key range
-- lowercase
SPLIT KEY RANGE krid7 FROM krid5 BY 'fe000000-0000-0000-0000-000000000000';
                   split key range                    
------------------------------------------------------
 key range id -> krid7
 bound        -> fe000000-0000-0000-0000-000000000000
(2 rows)

DROP DISTRIBUTION ALL CASCADE;
   drop distribution    
------------------------
 distribution id -> ds1
 distribution id -> ds2
(2 rows)

DROP KEY RANGE ALL;
 drop key range 
----------------
(0 rows)

